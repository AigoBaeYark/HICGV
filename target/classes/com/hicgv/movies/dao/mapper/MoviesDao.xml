<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hicgv.movies.dao.MoviesDao">
	<select id="movies" resultType="MoviesDto">
		SELECT * FROM HICGV_MOVIE ORDER BY RANKING
	</select> <!-- ## sql문 뒤에 ; 꼭 빼기 !! 안 뺴서 500오류 -->
	<!-- 해당영화경로불러오기, 영화정보가져오기 sql코드  -->
	<select id="moviesdv" parameterType="String" resultType="MoviesDto">
		<!-- Dto를 Dao로 써서 Invalid bound statement (not found): 오류 뜸 -->
		SELECT * FROM HICGV_MOVIE WHERE MOVIE_ID=#{movie_id}	
	</select>
	<!-- 배우가져오는 sql코드 -->
	<select id="actor" parameterType="String" resultType="MovieActorDto">
		SELECT * FROM HICGV_MOVIE_ACTOR WHERE MOVIE_ID=#{movie_id}
	</select>
	<!-- 감독가져오는 sql코드 -->
	<select id="director" parameterType="String" resultType="MovieDirectorDto">
		SELECT * FROM HICGV_MOVIE_DIRECTOR WHERE MOVIE_ID=#{movie_id}
	</select>	
	<!-- 트레일러가져오는 sql코드 -->
	<select id="trailer" parameterType="String" resultType="MovieTrailerDto">
		SELECT * FROM HICGV_MOVIE_TRAILER WHERE MOVIE_ID=#{movie_id}
	</select>
	<!-- 트레일러갯수가져오는 sql코드 -->
	<select id="trailercnt" parameterType="String" resultType="Integer">
		SELECT COUNT(*) FROM HICGV_MOVIE_TRAILER WHERE MOVIE_ID = #{movie_id}
	</select>
	<!-- 포스터가져오는 sql코드 -->
	<select id="poster" resultType="MoviePosterDto">
		SELECT * FROM HICGV_MOVIE_POSTER WHERE MOVIE_ID=#{param1}
	</select>
	<!-- 포스터갯수가져오는 sql코드 -->
	<select id="postercnt" resultType="Integer">
		SELECT COUNT(*) FROM HICGV_MOVIE_POSTER WHERE MOVIE_ID = #{param1}
	</select>
	
	<insert id = "insertRefreshMovies">
		insert hicgv_movies values(#{param1})
	</insert>
	
	<update id = "refreshRank">
		update hicgv_movies
		on rank = #{param1} <!-- api에서 가져온 랭크 -->
		where movie_id = #{param2} <!-- api에서 가져온 코드 -->
	</update>
	
	
			
			
	









	<!-- <select id="movieTrailer" resultType="com.hicgv.movies.dto.MovieTrailerDto"> 
		select * from movieTrailer where moive_id = #{param1} 트레일러예시 </select> 추후추가예정 -->








</mapper> 
 